import { Box, Collapse, IconButton, Typography, useMediaQuery, useTheme } from '@mui/material';\nimport { useState } from 'react';\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\nimport ExpandLessIcon from '@mui/icons-material/ExpandLess';\nimport type { SkillDefinition } from '../models/SkillDefinition';\nimport { Position } from '../models/SkillDefinition';\nimport { formatPositionDisplay, calculateDifficultyScore } from '../utils/skillUtils';\n\ninterface MobileSkillCategoryProps {\n  category: string;\n  skills: SkillDefinition[];\n  selectedPositions: Record<string, Position | undefined>;\n  onPlaySkill: (definition: SkillDefinition) => void;\n  onAddToRoutine: (definition: SkillDefinition) => void;\n  onSelectPosition: (skillName: string, position: Position) => void;\n  defaultExpanded?: boolean;\n}\n\nexport const MobileSkillCategory = ({\n  category,\n  skills,\n  selectedPositions,\n  onPlaySkill,\n  onAddToRoutine,\n  onSelectPosition,\n  defaultExpanded = false,\n}: MobileSkillCategoryProps) => {\n  const [expanded, setExpanded] = useState(defaultExpanded);\n  const theme = useTheme();\n  const isMobile = useMediaQuery(theme.breakpoints.down('sm'));\n\n  if (!isMobile) return null; // Only render on mobile\n\n  return (\n    <Box>\n      {/* Category Header - Collapsible */}\n      <Box\n        sx={{\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'space-between',\n          py: 2,\n          px: 1,\n          bgcolor: 'background.paper',\n          borderRadius: 1,\n          mb: 1,\n          cursor: 'pointer',\n        }}\n        onClick={() => setExpanded(!expanded)}\n      >\n        <Typography variant=\"h6\" sx={{ fontWeight: 600, color: 'primary.main' }}>\n          {category}\n        </Typography>\n        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n          <Typography variant=\"body2\" sx={{ color: 'text.secondary' }}>\n            {skills.length} skills\n          </Typography>\n          <IconButton size=\"small\">\n            {expanded ? <ExpandLessIcon /> : <ExpandMoreIcon />}\n          </IconButton>\n        </Box>\n      </Box>\n\n      {/* Skills List - Collapsible */}\n      <Collapse in={expanded}>\n        <Box sx={{ pb: 2 }}>\n          {skills.map((def, idx) => {\n            const hasMultiplePositions = def.possiblePositions && def.possiblePositions.length > 1;\n            const selectedPosition = selectedPositions[def.name];\n\n            return (\n              <Box\n                key={`${category}-${idx}`}\n                sx={{\n                  bgcolor: 'background.paper',\n                  borderRadius: 2,\n                  p: 2,\n                  mb: 1,\n                  border: '1px solid',\n                  borderColor: 'divider',\n                }}\n              >\n                {/* Skill Name & Quick Actions */}\n                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', mb: 1 }}>\n                  <Typography variant=\"body1\" sx={{ fontWeight: 500, flex: 1 }}>\n                    {def.name}\n                  </Typography>\n                  <Box sx={{ display: 'flex', gap: 1, flexShrink: 0 }}>\n                    <IconButton\n                      size=\"large\"\n                      onClick={() => onPlaySkill(def)}\n                      sx={{\n                        bgcolor: 'primary.main',\n                        color: 'white',\n                        minWidth: 48,\n                        minHeight: 48,\n                        '&:hover': { bgcolor: 'primary.dark' },\n                      }}\n                    >\n                      â–¶\n                    </IconButton>\n                    <IconButton\n                      size=\"large\"\n                      onClick={() => onAddToRoutine(def)}\n                      sx={{\n                        bgcolor: 'success.main',\n                        color: 'white',\n                        minWidth: 48,\n                        minHeight: 48,\n                        '&:hover': { bgcolor: 'success.dark' },\n                      }}\n                    >\n                      +\n                    </IconButton>\n                  </Box>\n                </Box>\n\n                {/* Skill Info Pills */}\n                <Box sx={{ display: 'flex', gap: 1, mb: 2, flexWrap: 'wrap' }}>\n                  {def.isBackSkill && (\n                    <Box\n                      sx={{\n                        bgcolor: 'warning.light',\n                        color: 'warning.contrastText',\n                        px: 1.5,\n                        py: 0.5,\n                        borderRadius: 1,\n                        fontSize: '0.875rem',\n                        fontWeight: 500,\n                      }}\n                    >\n                      Back\n                    </Box>\n                  )}\n                  <Box\n                    sx={{\n                      bgcolor: 'secondary.light',\n                      color: 'secondary.contrastText',\n                      px: 1.5,\n                      py: 0.5,\n                      borderRadius: 1,\n                      fontSize: '0.875rem',\n                      fontWeight: 500,\n                    }}\n                  >\n                    {def.twists}T\n                  </Box>\n                </Box>\n\n                {/* Position Selection */}\n                {hasMultiplePositions ? (\n                  <Box sx={{ display: 'flex', gap: 1, flexWrap: 'wrap' }}>\n                    {def.possiblePositions!.map((pos) => {\n                      const isSelected = selectedPosition === pos;\n                      const skillWithPosition = { ...def, position: pos };\n                      const difficulty = calculateDifficultyScore(skillWithPosition);\n\n                      return (\n                        <Box\n                          key={pos}\n                          onClick={() => onSelectPosition(def.name, pos)}\n                          sx={{\n                            bgcolor: isSelected ? 'success.main' : 'rgba(255, 255, 255, 0.08)',\n                            color: isSelected ? 'success.contrastText' : 'rgba(255, 255, 255, 0.7)',\n                            px: 2,\n                            py: 1,\n                            borderRadius: 2,\n                            fontSize: '0.875rem',\n                            fontWeight: isSelected ? 600 : 400,\n                            cursor: 'pointer',\n                            minHeight: 40, // Better touch target\n                            display: 'flex',\n                            alignItems: 'center',\n                            border: isSelected ? '2px solid' : '1px solid',\n                            borderColor: isSelected ? 'success.dark' : 'rgba(255, 255, 255, 0.23)',\n                            transition: 'all 0.2s ease-in-out',\n                            '&:active': {\n                              transform: 'scale(0.98)',\n                            },\n                          }}\n                        >\n                          {formatPositionDisplay(pos)}: {difficulty} DD\n                        </Box>\n                      );\n                    })}\n                  </Box>\n                ) : (\n                  <Box\n                    sx={{\n                      bgcolor: 'primary.main',\n                      color: 'primary.contrastText',\n                      px: 2,\n                      py: 1,\n                      borderRadius: 2,\n                      fontSize: '0.875rem',\n                      fontWeight: 600,\n                      display: 'inline-flex',\n                      alignItems: 'center',\n                    }}\n                  >\n                    {formatPositionDisplay(def.position)}: {calculateDifficultyScore(def)} DD\n                  </Box>\n                )}\n              </Box>\n            );\n          })}\n        </Box>\n      </Collapse>\n    </Box>\n  );\n};